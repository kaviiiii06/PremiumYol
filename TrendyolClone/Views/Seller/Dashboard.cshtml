@model TrendyolClone.Models.DTOs.SaticiDashboardDto
@{
    ViewData["Title"] = "Satıcı Paneli";
    var satici = ViewBag.Satici as TrendyolClone.Models.Satici;
}

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2>Hoş Geldiniz, @satici?.MagazaAdi</h2>
            <p class="text-muted">Satıcı paneline hoş geldiniz. İşletmenizi buradan yönetebilirsiniz.</p>
        </div>
    </div>

    <!-- İstatistik Kartları -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h6 class="card-title">Bugün</h6>
                    <h3>@Model.BugunSatis.ToString("C")</h3>
                    <small>Günlük Satış</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h6 class="card-title">Bu Hafta</h6>
                    <h3>@Model.BuHaftaSatis.ToString("C")</h3>
                    <small>Haftalık Satış</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h6 class="card-title">Bu Ay</h6>
                    <h3>@Model.BuAySatis.ToString("C")</h3>
                    <small>Aylık Satış</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <h6 class="card-title">Toplam Kazanç</h6>
                    <h3>@Model.ToplamKazanc.ToString("C")</h3>
                    <small>Tüm Zamanlar</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Sipariş Durumları -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h2 class="text-danger">@Model.BekleyenSiparis</h2>
                    <p class="mb-0">Bekleyen Sipariş</p>
                    <a href="@Url.Action("Orders", new { durum = 0 })" class="btn btn-sm btn-outline-danger mt-2">Görüntüle</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h2 class="text-warning">@Model.HazirlaniyorSiparis</h2>
                    <p class="mb-0">Hazırlanıyor</p>
                    <a href="@Url.Action("Orders", new { durum = 1 })" class="btn btn-sm btn-outline-warning mt-2">Görüntüle</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h2 class="text-info">@Model.KargodaSiparis</h2>
                    <p class="mb-0">Kargoda</p>
                    <a href="@Url.Action("Orders", new { durum = 2 })" class="btn btn-sm btn-outline-info mt-2">Görüntüle</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h2 class="text-success">@Model.BekleyenOdeme.ToString("C")</h2>
                    <p class="mb-0">Bekleyen Ödeme</p>
                    <a href="@Url.Action("Payments")" class="btn btn-sm btn-outline-success mt-2">Görüntüle</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Stok Uyarıları -->
    @if (Model.DusukStokUrun > 0 || Model.TukenStokUrun > 0)
    {
        <div class="row mb-4">
            <div class="col-12">
                <div class="alert alert-warning">
                    <h5><i class="bi bi-exclamation-triangle"></i> Stok Uyarıları</h5>
                    @if (Model.DusukStokUrun > 0)
                    {
                        <p class="mb-1"><strong>@Model.DusukStokUrun</strong> ürününüzün stoğu azalıyor (10'dan az)</p>
                    }
                    @if (Model.TukenStokUrun > 0)
                    {
                        <p class="mb-0"><strong>@Model.TukenStokUrun</strong> ürününüzün stoğu tükendi</p>
                    }
                    <a href="@Url.Action("Products")" class="btn btn-sm btn-warning mt-2">Ürünleri Görüntüle</a>
                </div>
            </div>
        </div>
    }

    <div class="row">
        <!-- Son 7 Gün Satışları -->
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Son 7 Gün Satışları</h5>
                </div>
                <div class="card-body">
                    <canvas id="satisGrafik" height="80"></canvas>
                </div>
            </div>
        </div>

        <!-- Popüler Ürünler -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Popüler Ürünler</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        @foreach (var urun in Model.PopulerUrunler)
                        {
                            <div class="list-group-item">
                                <div class="d-flex align-items-center">
                                    <img src="@(urun.Resim ?? "/images/no-image.png")" alt="@urun.UrunAdi" class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                    <div class="ms-3 flex-grow-1">
                                        <h6 class="mb-0">@urun.UrunAdi</h6>
                                        <small class="text-muted">@urun.SatisSayisi satış</small>
                                    </div>
                                    <strong>@urun.Tutar.ToString("C")</strong>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Son Siparişler -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Son Siparişler</h5>
                    <a href="@Url.Action("Orders")" class="btn btn-sm btn-primary">Tümünü Gör</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Sipariş No</th>
                                    <th>Ürün</th>
                                    <th>Müşteri</th>
                                    <th>Adet</th>
                                    <th>Tutar</th>
                                    <th>Kazanç</th>
                                    <th>Durum</th>
                                    <th>Tarih</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var siparis in Model.SonSiparisler)
                                {
                                    <tr>
                                        <td><a href="@Url.Action("OrderDetails", new { id = siparis.Id })">@siparis.SiparisNo</a></td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="@(siparis.UrunResmi ?? "/images/no-image.png")" alt="@siparis.UrunAdi" class="rounded me-2" style="width: 40px; height: 40px; object-fit: cover;">
                                                @siparis.UrunAdi
                                            </div>
                                        </td>
                                        <td>@siparis.MusteriAdi</td>
                                        <td>@siparis.Adet</td>
                                        <td>@siparis.ToplamTutar.ToString("C")</td>
                                        <td><strong class="text-success">@siparis.SaticiKazanci.ToString("C")</strong></td>
                                        <td>
                                            @switch (siparis.Durum)
                                            {
                                                case TrendyolClone.Models.SaticiSiparisDurum.YeniSiparis:
                                                    <span class="badge bg-danger">Yeni</span>
                                                    break;
                                                case TrendyolClone.Models.SaticiSiparisDurum.Hazirlaniyor:
                                                    <span class="badge bg-warning">Hazırlanıyor</span>
                                                    break;
                                                case TrendyolClone.Models.SaticiSiparisDurum.KargoyaVerildi:
                                                    <span class="badge bg-info">Kargoda</span>
                                                    break;
                                                case TrendyolClone.Models.SaticiSiparisDurum.TeslimEdildi:
                                                    <span class="badge bg-success">Teslim Edildi</span>
                                                    break;
                                            }
                                        </td>
                                        <td>@siparis.SiparisTarihi.ToString("dd.MM.yyyy")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Satış grafiği
    const ctx = document.getElementById('satisGrafik');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: [@Html.Raw(string.Join(",", Model.SonYediGun.Select(g => $"'{g.Tarih:dd.MM}'")))],
            datasets: [{
                label: 'Satış (₺)',
                data: [@string.Join(",", Model.SonYediGun.Select(g => g.Tutar))],
                borderColor: 'rgb(75, 192, 192)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
}
